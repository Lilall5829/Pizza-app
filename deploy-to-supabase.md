# ğŸš€ Supabase çº¿ä¸Šéƒ¨ç½²æŒ‡å—

## æ­¥éª¤ 1: åˆ›å»ºçº¿ä¸Šé¡¹ç›®

### 1.1 è®¿é—® Supabase

- æ‰“å¼€ [https://supabase.com](https://supabase.com)
- æ³¨å†Œæˆ–ç™»å½•è´¦æˆ·

### 1.2 åˆ›å»ºæ–°é¡¹ç›®

1. ç‚¹å‡» "New Project"
2. å¡«å†™é¡¹ç›®ä¿¡æ¯ï¼š
   ```
   Project Name: food-ordering
   Database Password: [è®¾ç½®å¼ºå¯†ç ï¼Œè®°ä½å®ƒ]
   Region: Southeast Asia (Singapore) æˆ–ç¦»ä½ æœ€è¿‘çš„
   Pricing Plan: Free (å¼€å§‹æ—¶é€‰æ‹©å…è´¹)
   ```
3. ç‚¹å‡» "Create new project"
4. ç­‰å¾… 1-2 åˆ†é’Ÿé¡¹ç›®åˆ›å»ºå®Œæˆ

## æ­¥éª¤ 2: è·å–é…ç½®ä¿¡æ¯

é¡¹ç›®åˆ›å»ºå®Œæˆåï¼š

1. åœ¨é¡¹ç›®ä»ªè¡¨æ¿ï¼Œç‚¹å‡»å·¦ä¾§ "Settings" â†’ "API"
2. å¤åˆ¶ä»¥ä¸‹ä¿¡æ¯ï¼š
   - **Project URL**: `https://ä½ çš„é¡¹ç›®ID.supabase.co`
   - **anon public**: `eyJå¼€å¤´çš„é•¿å­—ç¬¦ä¸²`

## æ­¥éª¤ 3: éƒ¨ç½²æ•°æ®åº“ç»“æ„

### 3.1 é€šè¿‡ Web ç•Œé¢éƒ¨ç½²ï¼ˆæ¨èï¼‰

1. åœ¨ Supabase é¡¹ç›®ä¸­ï¼Œç‚¹å‡»å·¦ä¾§ "SQL Editor"
2. ç‚¹å‡» "New query"
3. å¤åˆ¶ç²˜è´´æ•°æ®åº“è¿ç§»è„šæœ¬ï¼ˆè§ä¸‹æ–¹ï¼‰
4. ç‚¹å‡» "Run" æ‰§è¡Œ

### 3.2 ä½¿ç”¨ CLI éƒ¨ç½²ï¼ˆå¯é€‰ï¼‰

```bash
# 1. ç™»å½• Supabase CLI
npx supabase login

# 2. è¿æ¥åˆ°ä½ çš„é¡¹ç›®
npx supabase link --project-ref YOUR_PROJECT_ID

# 3. æ¨é€æ•°æ®åº“ç»“æ„
npx supabase db push
```

## æ­¥éª¤ 4: æ•°æ®åº“è¿ç§»è„šæœ¬

åœ¨ SQL Editor ä¸­è¿è¡Œä»¥ä¸‹è„šæœ¬ï¼š

```sql
-- åˆ›å»ºäº§å“è¡¨
CREATE TABLE IF NOT EXISTS products (
    id bigint GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    name text NOT NULL,
    image text,
    price real NOT NULL
);

-- åˆ›å»ºç”¨æˆ·æ¡£æ¡ˆè¡¨
CREATE TABLE IF NOT EXISTS profiles (
    id uuid REFERENCES auth.users(id) ON DELETE CASCADE PRIMARY KEY,
    updated_at timestamp with time zone,
    username text,
    full_name text,
    avatar_url text,
    website text,
    "group" text DEFAULT 'USER' NOT NULL,
    CONSTRAINT username_length CHECK (char_length(username) >= 3)
);

-- åˆ›å»ºè®¢å•è¡¨
CREATE TABLE IF NOT EXISTS orders (
    id bigint GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    status text DEFAULT 'New' NOT NULL,
    total double precision DEFAULT 0 NOT NULL,
    user_id uuid REFERENCES profiles(id) ON UPDATE CASCADE ON DELETE CASCADE
);

-- åˆ›å»ºè®¢å•é¡¹ç›®è¡¨
CREATE TABLE IF NOT EXISTS order_items (
    id bigint GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    product_id bigint REFERENCES products(id) ON UPDATE CASCADE ON DELETE CASCADE NOT NULL,
    size text DEFAULT 'M' NOT NULL,
    quantity integer DEFAULT 1 NOT NULL,
    order_id bigint REFERENCES orders(id) ON UPDATE CASCADE ON DELETE CASCADE NOT NULL
);

-- åˆ›å»ºç”¨æˆ·æ³¨å†Œè§¦å‘å™¨å‡½æ•°
CREATE OR REPLACE FUNCTION handle_new_user()
RETURNS trigger AS $$
BEGIN
  INSERT INTO public.profiles (id, full_name, avatar_url)
  VALUES (new.id, new.raw_user_meta_data->>'full_name', new.raw_user_meta_data->>'avatar_url');
  RETURN new;
END;
$$ LANGUAGE plpgsql SECURITY DEFINER;

-- åˆ›å»ºè§¦å‘å™¨
DROP TRIGGER IF EXISTS on_auth_user_created ON auth.users;
CREATE TRIGGER on_auth_user_created
  AFTER INSERT ON auth.users
  FOR EACH ROW EXECUTE PROCEDURE handle_new_user();

-- è®¾ç½®è¡Œçº§å®‰å…¨ç­–ç•¥ (RLS)
ALTER TABLE products ENABLE ROW LEVEL SECURITY;
ALTER TABLE profiles ENABLE ROW LEVEL SECURITY;
ALTER TABLE orders ENABLE ROW LEVEL SECURITY;
ALTER TABLE order_items ENABLE ROW LEVEL SECURITY;

-- äº§å“è¡¨ç­–ç•¥ï¼šè®¤è¯ç”¨æˆ·å¯ä»¥è¿›è¡Œæ‰€æœ‰æ“ä½œ
CREATE POLICY "Allow authenticated users ALL operations" ON products
  FOR ALL TO authenticated USING (true) WITH CHECK (true);

-- ç”¨æˆ·æ¡£æ¡ˆç­–ç•¥
CREATE POLICY "Public profiles are viewable by everyone" ON profiles
  FOR SELECT USING (true);

CREATE POLICY "Users can insert their own profile" ON profiles
  FOR INSERT WITH CHECK (auth.uid() = id);

CREATE POLICY "Users can update own profile" ON profiles
  FOR UPDATE USING (auth.uid() = id);

-- è®¢å•ç­–ç•¥ï¼šè®¤è¯ç”¨æˆ·å¯ä»¥è¿›è¡Œæ‰€æœ‰æ“ä½œ
CREATE POLICY "All operations to authenticated users" ON orders
  FOR ALL TO authenticated USING (true);

-- è®¢å•é¡¹ç›®ç­–ç•¥ï¼šè®¤è¯ç”¨æˆ·å¯ä»¥è¿›è¡Œæ‰€æœ‰æ“ä½œ
CREATE POLICY "All operations to authenticated users" ON order_items
  FOR ALL TO authenticated USING (true);

-- å¯ç”¨å®æ—¶è®¢é˜…
ALTER PUBLICATION supabase_realtime ADD TABLE orders;
```

## æ­¥éª¤ 5: æ›´æ–°ç¯å¢ƒé…ç½®

å°†ä½ çš„ `.env` æ–‡ä»¶æ›´æ–°ä¸ºï¼š

```env
# Supabase çº¿ä¸Šé…ç½®
EXPO_PUBLIC_SUPABASE_URL=https://ä½ çš„é¡¹ç›®ID.supabase.co
EXPO_PUBLIC_SUPABASE_ANON=ä½ çš„anon_publicå¯†é’¥

# Stripe é…ç½® (ä¿æŒä¸å˜)
EXPO_PUBLIC_STRIPE_PUBLISHABLE_KEY=pk_test_51P7JPaP8kqU6cZlPtVSZYqBltWgb07wvR04cwN9pcLo3Co3Sxr5jzJv25fzfGUJKtVj9QN02RW44EUHiqU0QeToY004hJbPkvw
STRIPE_SECRET_KEY=sk_test_51P7JPaP8kqU6cZlPpJA8xie9QGmP8EipfCC4eZh4KoBoyTxE7LYPMiEeVFR3vyQ41VRPAVV0yXmlx9XiqCYeuRs3008RKr9UUE
```

## æ­¥éª¤ 6: æ·»åŠ ç¤ºä¾‹æ•°æ®ï¼ˆå¯é€‰ï¼‰

åœ¨ SQL Editor ä¸­è¿è¡Œï¼š

```sql
-- æ·»åŠ ç¤ºä¾‹äº§å“æ•°æ®
INSERT INTO products (name, image, price) VALUES
('Margherita Pizza', 'https://example.com/margherita.jpg', 12.99),
('Pepperoni Pizza', 'https://example.com/pepperoni.jpg', 15.99),
('Hawaiian Pizza', 'https://example.com/hawaiian.jpg', 16.99),
('Veggie Supreme', 'https://example.com/veggie.jpg', 14.99);
```

## æ­¥éª¤ 7: æµ‹è¯•è¿æ¥

æ›´æ–°é…ç½®åï¼Œé‡å¯åº”ç”¨ï¼š

```bash
npm start
```

æ£€æŸ¥ï¼š

1. åº”ç”¨èƒ½å¦æ­£å¸¸å¯åŠ¨
2. æ˜¯å¦èƒ½çœ‹åˆ°äº§å“åˆ—è¡¨
3. ç”¨æˆ·æ³¨å†Œ/ç™»å½•æ˜¯å¦å·¥ä½œ

## ğŸ”’ å®‰å…¨æ³¨æ„äº‹é¡¹

1. **æ•°æ®åº“å¯†ç **: å¦¥å–„ä¿ç®¡ä½ è®¾ç½®çš„æ•°æ®åº“å¯†ç 
2. **API å¯†é’¥**: ä¸è¦å°†å¯†é’¥æäº¤åˆ°å…¬å…±ä»£ç ä»“åº“
3. **RLS ç­–ç•¥**: æ ¹æ®éœ€è¦è°ƒæ•´è¡Œçº§å®‰å…¨ç­–ç•¥

## ğŸ¯ å®Œæˆæ ‡å¿—

éƒ¨ç½²æˆåŠŸçš„æ ‡å¿—ï¼š

- âœ… Supabase é¡¹ç›®åˆ›å»ºæˆåŠŸ
- âœ… æ•°æ®åº“è¡¨åˆ›å»ºå®Œæˆ
- âœ… åº”ç”¨èƒ½è¿æ¥åˆ°çº¿ä¸Šæ•°æ®åº“
- âœ… ç”¨æˆ·è®¤è¯åŠŸèƒ½æ­£å¸¸
- âœ… äº§å“æ•°æ®èƒ½æ­£å¸¸åŠ è½½

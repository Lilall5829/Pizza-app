exports.id=446,exports.ids=[446],exports.modules={7245:(e,t,r)=>{Promise.resolve().then(r.t.bind(r,2994,23)),Promise.resolve().then(r.t.bind(r,6114,23)),Promise.resolve().then(r.t.bind(r,9727,23)),Promise.resolve().then(r.t.bind(r,9671,23)),Promise.resolve().then(r.t.bind(r,1868,23)),Promise.resolve().then(r.t.bind(r,4759,23))},7606:(e,t,r)=>{Promise.resolve().then(r.bind(r,381)),Promise.resolve().then(r.bind(r,488)),Promise.resolve().then(r.bind(r,1012))},6680:(e,t,r)=>{"use strict";r.d(t,{IA:()=>c,Tn:()=>d});var s=r(2777),n=r(7048),i=r(4412),o=r(4976),a=r(119);let c=()=>{let{session:e}=(0,n.a)(),t=e?.user.id;return(0,i.a)({queryKey:["orders",{userId:t}],queryFn:async()=>{if(!t)return null;let{data:e,error:r}=await s.O.from("orders").select("*").eq("user_id",t).order("created_at",{ascending:!1});if(r)throw Error(r.message);return e}})},d=()=>{let e=(0,o.NL)(),{session:t}=(0,n.a)(),r=t?.user.id;return(0,a.D)({async mutationFn(e){let{error:t,data:n}=await s.O.from("orders").insert({...e,user_id:r}).select().single();if(t)throw Error(t.message);return n},async onSuccess(){await e.invalidateQueries({queryKey:["orders"]})}})}},488:(e,t,r)=>{"use strict";r.d(t,{PaymentConfigChecker:()=>i});var s=r(326),n=r(7577);function i(){let[e,t]=(0,n.useState)(!1),r="pk_test_51P7JPaP8kqU6cZlPtVSZYqBltWgb07wvR04cwN9pcLo3Co3Sxr5jzJv25fzfGUJKtVj9QN02RW44EUHiqU0QeToY004hJbPkvw",i=r.startsWith("pk_test_");return e?(0,s.jsxs)("div",{className:"fixed bottom-4 right-4 bg-white border border-gray-300 rounded-lg shadow-lg p-4 max-w-sm",children:[(0,s.jsxs)("div",{className:"flex justify-between items-start mb-3",children:[s.jsx("h3",{className:"font-medium text-gray-900",children:"Payment Configuration"}),s.jsx("button",{onClick:()=>t(!1),className:"text-gray-400 hover:text-gray-600",children:"\xd7"})]}),(0,s.jsxs)("div",{className:"space-y-2 text-sm",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[s.jsx("span",{children:"Environment:"}),s.jsx("span",{className:"px-2 py-1 rounded text-xs font-medium bg-green-100 text-green-800",children:"production"})]}),(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[s.jsx("span",{children:"Payment Mode:"}),s.jsx("span",{className:"px-2 py-1 rounded text-xs font-medium bg-green-100 text-green-800",children:"\uD83D\uDE80 REAL API"})]}),(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[s.jsx("span",{children:"Stripe Mode:"}),s.jsx("span",{className:`px-2 py-1 rounded text-xs font-medium ${i?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:i?"\uD83E\uDDEA TEST":"⚠️ LIVE"})]}),(0,s.jsxs)("div",{children:[s.jsx("span",{className:"text-gray-600",children:"Key:"}),s.jsx("div",{className:"mt-1 font-mono text-xs bg-gray-100 p-2 rounded",children:r?`${r.substring(0,20)}...`:"Not configured"})]}),s.jsx("div",{className:`mt-3 p-2 rounded text-xs ${i?"bg-green-50 text-green-700":"bg-red-50 text-red-700"}`,children:i?(0,s.jsxs)(s.Fragment,{children:["✅ ",s.jsx("strong",{children:"Real Stripe Test API"}),s.jsx("br",{}),"Transactions will appear in Stripe Dashboard."]}):(0,s.jsxs)(s.Fragment,{children:["⚠️ ",s.jsx("strong",{children:"LIVE MODE!"}),s.jsx("br",{}),"Real charges will occur!"]})}),i&&(0,s.jsxs)("div",{className:"mt-3 text-xs",children:[s.jsx("div",{className:"font-medium text-gray-700 mb-1",children:"Test Cards:"}),(0,s.jsxs)("div",{className:"space-y-1 text-gray-600",children:[s.jsx("div",{children:"Success: 4242 4242 4242 4242"}),s.jsx("div",{children:"Decline: 4000 0000 0000 0002"})]})]})]})]}):s.jsx("button",{onClick:()=>t(!0),className:"fixed bottom-4 right-4 bg-blue-600 text-white px-3 py-1 rounded text-sm hover:bg-blue-700",children:"\uD83D\uDCB3 Check Payment Config"})}},1012:(e,t,r)=>{"use strict";r.d(t,{Providers:()=>d,a:()=>n.a,j:()=>i.j});var s=r(326),n=r(7048),i=r(5846),o=r(2852),a=r(4976),c=r(7577);function d({children:e}){let[t]=(0,c.useState)(()=>new o.S({defaultOptions:{queries:{staleTime:6e4,gcTime:6e5}}}));return s.jsx(a.aH,{client:t,children:s.jsx(n.Z,{children:s.jsx(i.Z,{children:e})})})}},2777:(e,t,r)=>{"use strict";r.d(t,{O:()=>s});let s=(0,r(3958).eI)("https://qvaydsqqgpufbzjudzod.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InF2YXlkc3FxZ3B1ZmJ6anVkem9kIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDg0OTA1NTUsImV4cCI6MjA2NDA2NjU1NX0.SEB2IZrZCvAXsijuaRDeLLA6B0DYrBHdlzKVGr5L2v0")},7048:(e,t,r)=>{"use strict";r.d(t,{Z:()=>o,a:()=>a});var s=r(326);r(2777);var n=r(7577);r(381);let i=(0,n.createContext)({session:null,profile:null,loading:!0,isAdmin:!1});function o({children:e}){let[t,r]=(0,n.useState)(null),[o,a]=(0,n.useState)(null),[c,d]=(0,n.useState)(!0);return(0,n.useRef)(null),console.log("Current auth state:",{userEmail:t?.user?.email,userRole:o?.group,isAdmin:o?.group==="ADMIN"}),s.jsx(i.Provider,{value:{session:t,loading:c,profile:o,isAdmin:o?.group==="ADMIN"},children:e})}let a=()=>(0,n.useContext)(i)},5846:(e,t,r)=>{"use strict";r.d(t,{Z:()=>f,j:()=>v});var s=r(326),n=r(2777),i=r(4976),o=r(119);let a=()=>((0,i.NL)(),(0,o.D)({async mutationFn(e){let{error:t,data:r}=await n.O.from("order_items").insert(e).select();if(t)throw Error(t.message);return r}}));var c=r(6680),d=r(8226);let l="pk_test_51P7JPaP8kqU6cZlPtVSZYqBltWgb07wvR04cwN9pcLo3Co3Sxr5jzJv25fzfGUJKtVj9QN02RW44EUHiqU0QeToY004hJbPkvw";l.startsWith("pk_test_")||console.warn("⚠️ Warning: Not using Stripe test key! Current key:",l.substring(0,20)+"...");let u=(0,d.J)(l),m=async e=>{console.log("\uD83D\uDD04 Attempting to fetch payment sheet params for amount:",e/100,"USD");try{let{data:{session:t},error:r}=await n.O.auth.getSession();if(r)throw console.error("❌ Session error:",r),Error("Authentication error: "+r.message);if(!t)throw Error("User not authenticated. Please sign in first.");console.log("✅ User authenticated:",t.user.email),console.log("\uD83D\uDCE1 Calling Supabase Function: payment-sheet");let{data:s,error:i}=await n.O.functions.invoke("payment-sheet",{body:{amount:e}});if(i){if(console.error("❌ Supabase Function error:",i),i.message.includes("Failed to fetch")||i.message.includes("CORS"))throw Error("\uD83C\uDF10 CORS Error: Supabase Function not deployed or CORS not configured.\nSolutions:\n1. Deploy the function: supabase functions deploy payment-sheet\n2. Check function logs in Supabase Dashboard\n3. Verify function is running at: https://qvaydsqqgpufbzjudzod.supabase.co/functions/v1/payment-sheet");if(i.message.includes("unauthorized")||i.message.includes("401"))throw Error("Authentication failed. Please sign out and sign back in.");throw Error("Supabase Function error: "+i.message)}if(!s)throw Error("No data returned from payment function");return console.log("✅ Payment sheet params fetched successfully"),s}catch(e){if(console.error("\uD83D\uDCA5 Error in fetchPaymentSheetParams:",e),e instanceof Error&&e.message.includes("Failed to fetch"))throw console.log("\uD83D\uDD27 Falling back to simulated payment due to network error"),Error("\uD83C\uDF10 Network Error: Cannot connect to Supabase Function.\nThis might be because:\n• Function not deployed\n• CORS configuration issue\n• Network connectivity problem\n\nTry switching to simulated payment mode for testing.");throw e}},p=async e=>{try{if(!await u)throw Error("Stripe failed to load");console.log("\uD83D\uDCB3 Processing TEST payment for amount:",e/100,"USD"),console.log("\uD83D\uDE80 Using REAL Stripe API in test mode");try{let t=await m(e);return console.log("✅ Payment Intent created:",t.paymentIntent),console.log("\uD83D\uDCCA Check your Stripe Dashboard for this test transaction!"),{success:!0,paymentMethod:"stripe_test_api",paymentIntentId:t.paymentIntent}}catch(e){if(console.error("Stripe payment error:",e),e instanceof Error&&e.message.includes("CORS"))return console.log("\uD83D\uDD04 Falling back to simulated payment due to CORS issue"),await new Promise(e=>setTimeout(e,1e3)),{success:!0,paymentMethod:"simulated_fallback",note:"Used simulated payment due to Supabase Function issue"};throw e}}catch(e){return console.error("Payment processing error:",e),{success:!1,error:e instanceof Error?e.message:"Payment failed"}}};var h=r(5047),g=r(7577),y=r(381);let x=(0,g.createContext)({items:[],addItem:()=>{},updateQuantity:()=>{},total:0,checkout:async()=>{}}),f=({children:e})=>{let[t,r]=(0,g.useState)([]),[n,i]=(0,g.useState)(!1),o=(0,h.useRouter)(),{mutate:d}=(0,c.Tn)(),{mutate:l}=a();(0,g.useEffect)(()=>{r([]),i(!0)},[]),(0,g.useEffect)(()=>{},[t,n]);let u=Number(t.reduce((e,t)=>e+=t.product.price*t.quantity,0).toFixed(2)),m=()=>{r([])},f=async e=>{if(0===t.length){y.ZP.error("Your cart is empty");return}y.ZP.loading("Processing your payment...");try{let t=await p(Math.floor(100*u));if(!t.success){y.ZP.dismiss(),y.ZP.error(t.error||"Payment failed");return}let r={total:u};e&&(r.customer_name=e.customerName,r.delivery_phone=e.phone,r.delivery_address=e.address,r.delivery_city=e.city,r.delivery_province=e.province,r.delivery_postal_code=e.postalCode,r.delivery_country=e.country,r.delivery_instructions=e.instructions||null),d(r,{onSuccess:v,onError:e=>{y.ZP.dismiss(),y.ZP.error("Failed to create order"),console.error("Order creation failed:",e)}})}catch(e){y.ZP.dismiss(),y.ZP.error("Payment processing failed"),console.error("Payment error:",e)}},v=e=>{l(t.map(t=>({order_id:e.id,product_id:t.product_id,quantity:t.quantity,size:t.size})),{onSuccess(){y.ZP.dismiss(),y.ZP.success("Order placed successfully!"),m(),o.push(`/orders/${e.id}`)},onError:e=>{y.ZP.dismiss(),y.ZP.error("Failed to save order items"),console.error("Order items creation failed:",e)}})};return s.jsx(x.Provider,{value:{items:t,addItem:(e,s,n=1)=>{let i=t.find(t=>t.product.id===e.id&&t.size===s);i?r(t.map(e=>e.id===i.id?{...e,quantity:e.quantity+n}:e)):r([{id:"cart-"+Date.now().toString(36)+Math.random().toString(36).substr(2),product:e,product_id:e.id,size:s,quantity:n},...t]),1===n?y.ZP.success(`${e.name} added to cart`):y.ZP.success(`${n} ${e.name} added to cart`)},updateQuantity:(e,s)=>{r(t.map(t=>t.id!=e?t:{...t,quantity:t.quantity+s}).filter(e=>e.quantity>0))},total:u,checkout:f},children:e})},v=()=>(0,g.useContext)(x)},9840:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>u,metadata:()=>l});var s=r(9510),n=r(5384),i=r.n(n),o=r(8570);let a=(0,o.createProxy)(String.raw`C:\Projects\react-native-project\FoodOrdering\src\components\PaymentConfig.tsx#PaymentConfigChecker`),c=(0,o.createProxy)(String.raw`C:\Projects\react-native-project\FoodOrdering\src\components\providers.tsx#Providers`);(0,o.createProxy)(String.raw`C:\Projects\react-native-project\FoodOrdering\src\components\providers.tsx#useAuth`),(0,o.createProxy)(String.raw`C:\Projects\react-native-project\FoodOrdering\src\components\providers.tsx#useCart`);var d=r(9125);r(5023);let l={title:"Food Ordering - Delicious Meals Delivered",description:"Order your favorite meals online with fast delivery"};function u({children:e}){return s.jsx("html",{lang:"en",children:s.jsx("body",{className:i().className,children:(0,s.jsxs)(c,{children:[s.jsx("div",{className:"min-h-screen bg-gray-50",children:e}),s.jsx(d.x7,{position:"top-center"}),s.jsx(a,{})]})})})}},5023:()=>{}};
(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[674],{2399:function(e,s,r){Promise.resolve().then(r.bind(r,2781))},3334:function(e,s,r){"use strict";r.d(s,{F_:function(){return x},WG:function(){return d},aF:function(){return c},fx:function(){return m},vM:function(){return o}});var t=r(5526),a=r(6593),l=r(9827),n=r(1770),i=r(9064);let d=()=>(0,a.a)({queryKey:["users"],queryFn:async()=>{let{data:e,error:s}=await t.O.from("profiles").select("\n          id,\n          full_name,\n          username,\n          group,\n          updated_at,\n          phone,\n          default_address,\n          default_city,\n          default_province,\n          default_postal_code,\n          default_country\n        ").order("updated_at",{ascending:!1});if(s)throw Error(s.message);return e}}),c=e=>(0,a.a)({queryKey:["users",e],queryFn:async()=>{let{data:s,error:r}=await t.O.from("profiles").select("*").eq("id",e).single();if(r)throw Error(r.message);return s},enabled:!!e}),o=()=>{let e=(0,l.NL)();return(0,n.D)({mutationFn:async e=>{let{userId:s,role:r}=e,{data:a,error:l}=await t.O.from("profiles").update({group:r,updated_at:new Date().toISOString()}).eq("id",s).select();if(l)throw l;if(!a||0===a.length)throw Error("User not found or you don't have permission to update this user");return a[0]},onSuccess:()=>{e.invalidateQueries({queryKey:["users"]}),i.ZP.success("User role updated successfully!")},onError:e=>{i.ZP.error(e.message||"Failed to update user role")}})},x=()=>{let e=(0,l.NL)();return(0,n.D)({mutationFn:async e=>{let{error:s}=await t.O.from("profiles").delete().eq("id",e);if(s)throw s;return{userId:e}},onSuccess:()=>{e.invalidateQueries({queryKey:["users"]}),i.ZP.success("User deleted successfully!")},onError:e=>{i.ZP.error(e.message||"Failed to delete user")}})},m=()=>(0,a.a)({queryKey:["users","stats"],queryFn:async()=>{let{data:e,error:s}=await t.O.from("profiles").select("group");if(s)throw s;let{count:r,error:a}=await t.O.from("orders").select("*",{count:"exact",head:!0});if(a)throw a;return{totalUsers:e.length,adminUsers:e.filter(e=>"ADMIN"===e.group).length,customerUsers:e.filter(e=>"ADMIN"!==e.group).length,totalOrders:r||0}}})},2781:function(e,s,r){"use strict";r.r(s),r.d(s,{default:function(){return v}});var t=r(7437),a=r(3334),l=r(9295),n=r(1192),i=r(9763);let d=(0,i.Z)("Users",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["path",{d:"M16 3.13a4 4 0 0 1 0 7.75",key:"1da9ce"}]]);var c=r(8906);let o=(0,i.Z)("UserCheck",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["polyline",{points:"16 11 18 13 22 9",key:"1pwet4"}]]),x=(0,i.Z)("TrendingUp",[["polyline",{points:"22 7 13.5 15.5 8.5 10.5 2 17",key:"126l90"}],["polyline",{points:"16 7 22 7 22 13",key:"kwv8wd"}]]);var m=r(3247),u=r(4630);let h=(0,i.Z)("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]]);var f=r(7648),j=r(9376),p=r(2265),y=r(9064);function v(){let{session:e,loading:s,isAdmin:r}=(0,n.a)(),[i,v]=(0,p.useState)(""),[g,N]=(0,p.useState)("ALL"),[w,b]=(0,p.useState)(null),[k,C]=(0,p.useState)(""),{data:U,isLoading:D,error:M}=(0,a.WG)(),{data:_,isLoading:A}=(0,a.fx)(),{mutate:S,isPending:Z}=(0,a.vM)(),{mutate:L,isPending:O}=(0,a.F_)();if((0,p.useEffect)(()=>{s||e||(0,j.redirect)("/sign-in"),s||!e||r||(0,j.redirect)("/")},[e,s,r]),s||D||A)return(0,t.jsxs)("div",{className:"min-h-screen",children:[(0,t.jsx)(l.h,{}),(0,t.jsx)("div",{className:"flex items-center justify-center h-64",children:(0,t.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary-500"})})]});if(!e||!r)return null;if(M)return(0,t.jsxs)("div",{className:"min-h-screen",children:[(0,t.jsx)(l.h,{}),(0,t.jsx)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:(0,t.jsxs)("div",{className:"text-center",children:[(0,t.jsx)("h1",{className:"text-2xl font-bold text-gray-900 mb-4",children:"Error Loading Users"}),(0,t.jsx)("p",{className:"text-gray-600",children:M.message})]})})]});let q=(null==U?void 0:U.filter(e=>{let s=!i||e.full_name&&e.full_name.toLowerCase().includes(i.toLowerCase())||e.username&&e.username.toLowerCase().includes(i.toLowerCase())||e.id&&e.id.toLowerCase().includes(i.toLowerCase()),r="ALL"===g||e.group===g;return s&&r}))||[],E=(s,r)=>{if(s===e.user.id&&"ADMIN"!==r){y.ZP.error("You cannot change your own admin role!");return}S({userId:s,role:r},{onSuccess:()=>{b(null),C("")}})},F=(s,r)=>{if(s===e.user.id){y.ZP.error("You cannot delete your own account!");return}window.confirm('Are you sure you want to delete user "'.concat(r,'"? This action cannot be undone.'))&&L(s)},I=(e,s)=>{b(e),C(s||"CUSTOMER")},P=()=>{b(null),C("")};return(0,t.jsxs)("div",{className:"min-h-screen",children:[(0,t.jsx)(l.h,{}),(0,t.jsxs)("main",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[(0,t.jsx)("div",{className:"mb-8",children:(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("h1",{className:"text-3xl font-bold text-gray-900",children:"User Management"}),(0,t.jsx)("p",{className:"mt-2 text-gray-600",children:"Manage user accounts, roles, and permissions"})]}),(0,t.jsx)(f.default,{href:"/admin",className:"bg-gray-600 text-white px-4 py-2 rounded-md hover:bg-gray-700 transition-colors",children:"Back to Admin"})]})}),_&&(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6 mb-8",children:[(0,t.jsx)("div",{className:"bg-white overflow-hidden shadow rounded-lg",children:(0,t.jsx)("div",{className:"p-5",children:(0,t.jsxs)("div",{className:"flex items-center",children:[(0,t.jsx)("div",{className:"flex-shrink-0",children:(0,t.jsx)(d,{className:"h-6 w-6 text-gray-400"})}),(0,t.jsx)("div",{className:"ml-5 w-0 flex-1",children:(0,t.jsxs)("dl",{children:[(0,t.jsx)("dt",{className:"text-sm font-medium text-gray-500 truncate",children:"Total Users"}),(0,t.jsx)("dd",{className:"text-lg font-medium text-gray-900",children:_.totalUsers})]})})]})})}),(0,t.jsx)("div",{className:"bg-white overflow-hidden shadow rounded-lg",children:(0,t.jsx)("div",{className:"p-5",children:(0,t.jsxs)("div",{className:"flex items-center",children:[(0,t.jsx)("div",{className:"flex-shrink-0",children:(0,t.jsx)(c.Z,{className:"h-6 w-6 text-red-400"})}),(0,t.jsx)("div",{className:"ml-5 w-0 flex-1",children:(0,t.jsxs)("dl",{children:[(0,t.jsx)("dt",{className:"text-sm font-medium text-gray-500 truncate",children:"Administrators"}),(0,t.jsx)("dd",{className:"text-lg font-medium text-gray-900",children:_.adminUsers})]})})]})})}),(0,t.jsx)("div",{className:"bg-white overflow-hidden shadow rounded-lg",children:(0,t.jsx)("div",{className:"p-5",children:(0,t.jsxs)("div",{className:"flex items-center",children:[(0,t.jsx)("div",{className:"flex-shrink-0",children:(0,t.jsx)(o,{className:"h-6 w-6 text-green-400"})}),(0,t.jsx)("div",{className:"ml-5 w-0 flex-1",children:(0,t.jsxs)("dl",{children:[(0,t.jsx)("dt",{className:"text-sm font-medium text-gray-500 truncate",children:"Customers"}),(0,t.jsx)("dd",{className:"text-lg font-medium text-gray-900",children:_.customerUsers})]})})]})})}),(0,t.jsx)("div",{className:"bg-white overflow-hidden shadow rounded-lg",children:(0,t.jsx)("div",{className:"p-5",children:(0,t.jsxs)("div",{className:"flex items-center",children:[(0,t.jsx)("div",{className:"flex-shrink-0",children:(0,t.jsx)(x,{className:"h-6 w-6 text-blue-400"})}),(0,t.jsx)("div",{className:"ml-5 w-0 flex-1",children:(0,t.jsxs)("dl",{children:[(0,t.jsx)("dt",{className:"text-sm font-medium text-gray-500 truncate",children:"Total Orders"}),(0,t.jsx)("dd",{className:"text-lg font-medium text-gray-900",children:_.totalOrders})]})})]})})})]}),(0,t.jsx)("div",{className:"bg-white shadow rounded-lg mb-6",children:(0,t.jsx)("div",{className:"p-6",children:(0,t.jsxs)("div",{className:"flex flex-col sm:flex-row gap-4",children:[(0,t.jsx)("div",{className:"flex-1",children:(0,t.jsxs)("div",{className:"relative",children:[(0,t.jsx)(m.Z,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 h-4 w-4"}),(0,t.jsx)("input",{type:"text",placeholder:"Search users by name, username, or ID...",value:i,onChange:e=>v(e.target.value),className:"pl-10 pr-4 py-2 w-full border border-gray-300 rounded-md focus:ring-primary-500 focus:border-primary-500"})]})}),(0,t.jsx)("div",{children:(0,t.jsxs)("select",{value:g,onChange:e=>N(e.target.value),className:"px-4 py-2 border border-gray-300 rounded-md focus:ring-primary-500 focus:border-primary-500",children:[(0,t.jsx)("option",{value:"ALL",children:"All Roles"}),(0,t.jsx)("option",{value:"ADMIN",children:"Administrators"}),(0,t.jsx)("option",{value:"CUSTOMER",children:"Customers"})]})})]})})}),(0,t.jsx)("div",{className:"bg-white shadow overflow-hidden sm:rounded-md",children:(0,t.jsx)("ul",{className:"divide-y divide-gray-200",children:0===q.length?(0,t.jsx)("li",{className:"px-6 py-8 text-center text-gray-500",children:"No users found matching your criteria."}):q.map(s=>{var r,a,l,n;return(0,t.jsx)("li",{children:(0,t.jsx)("div",{className:"px-6 py-4",children:(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,t.jsx)("div",{className:"flex-shrink-0",children:(0,t.jsx)("div",{className:"h-10 w-10 rounded-full bg-gray-300 flex items-center justify-center",children:(0,t.jsx)("span",{className:"text-sm font-medium text-gray-700",children:(null===(a=s.full_name)||void 0===a?void 0:null===(r=a.charAt(0))||void 0===r?void 0:r.toUpperCase())||(null===(n=s.username)||void 0===n?void 0:null===(l=n.charAt(0))||void 0===l?void 0:l.toUpperCase())||"U"})})}),(0,t.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,t.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,t.jsx)(f.default,{href:"/admin/users/".concat(s.id),className:"text-sm font-medium text-indigo-600 hover:text-indigo-900 truncate",children:s.full_name||s.username||"Unknown User"}),(0,t.jsx)("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ".concat("ADMIN"===s.group?"bg-red-100 text-red-800":"bg-green-100 text-green-800"),children:"ADMIN"===s.group?"Admin":"Customer"})]}),(0,t.jsxs)("div",{className:"flex items-center space-x-4 mt-1",children:[(0,t.jsxs)("p",{className:"text-sm text-gray-500 truncate",children:["ID: ",s.id]}),s.phone&&(0,t.jsxs)("p",{className:"text-sm text-gray-500",children:["\uD83D\uDCDE ",s.phone]}),s.default_city&&(0,t.jsxs)("p",{className:"text-sm text-gray-500",children:["\uD83D\uDCCD ",s.default_city]})]}),(0,t.jsxs)("p",{className:"text-xs text-gray-400 mt-1",children:["Joined:"," ",new Date(s.updated_at).toLocaleDateString()]})]})]}),(0,t.jsx)("div",{className:"flex items-center space-x-2",children:w===s.id?(0,t.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,t.jsxs)("select",{value:k,onChange:e=>C(e.target.value),className:"text-sm border border-gray-300 rounded-md px-2 py-1",disabled:Z,children:[(0,t.jsx)("option",{value:"CUSTOMER",children:"Customer"}),(0,t.jsx)("option",{value:"ADMIN",children:"Admin"})]}),(0,t.jsx)("button",{onClick:()=>E(s.id,k),disabled:Z,className:"text-green-600 hover:text-green-900 text-sm font-medium disabled:opacity-50",children:Z?"Saving...":"Save"}),(0,t.jsx)("button",{onClick:P,disabled:Z,className:"text-gray-600 hover:text-gray-900 text-sm font-medium",children:"Cancel"})]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("button",{onClick:()=>I(s.id,s.group),className:"text-indigo-600 hover:text-indigo-900 p-1",title:"Edit Role",children:(0,t.jsx)(u.Z,{className:"h-4 w-4"})}),s.id!==e.user.id&&(0,t.jsx)("button",{onClick:()=>F(s.id,s.full_name||s.username||"Unknown User"),disabled:O,className:"text-red-600 hover:text-red-900 p-1 disabled:opacity-50",title:"Delete User",children:(0,t.jsx)(h,{className:"h-4 w-4"})})]})})]})})},s.id)})})}),(0,t.jsx)("div",{className:"mt-8",children:(0,t.jsx)("div",{className:"bg-yellow-50 border border-yellow-200 rounded-md p-4",children:(0,t.jsxs)("div",{className:"flex",children:[(0,t.jsx)("div",{className:"flex-shrink-0",children:(0,t.jsx)("svg",{className:"h-5 w-5 text-yellow-400",fill:"currentColor",viewBox:"0 0 20 20",children:(0,t.jsx)("path",{fillRule:"evenodd",d:"M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z",clipRule:"evenodd"})})}),(0,t.jsxs)("div",{className:"ml-3",children:[(0,t.jsx)("h3",{className:"text-sm font-medium text-yellow-800",children:"User Management Guidelines"}),(0,t.jsx)("div",{className:"mt-2 text-sm text-yellow-700",children:(0,t.jsxs)("ul",{className:"list-disc list-inside space-y-1",children:[(0,t.jsx)("li",{children:"You cannot modify your own admin role or delete your own account"}),(0,t.jsx)("li",{children:"Deleting a user will remove their profile but may not remove their authentication account"}),(0,t.jsx)("li",{children:"Role changes take effect immediately"}),(0,t.jsx)("li",{children:"Admin users have full access to the admin panel"})]})})]})]})})})]})]})}},9295:function(e,s,r){"use strict";r.d(s,{h:function(){return x}});var t=r(7437),a=r(3896),l=r(9099),n=r(3247),i=r(6275),d=r(2369),c=r(8293),o=r(7648);function x(){let{session:e,isAdmin:s}=(0,a.a)(),{items:r}=(0,l.j)(),x=r.reduce((e,s)=>e+s.quantity,0);return(0,t.jsx)("header",{className:"bg-white shadow-sm border-b",children:(0,t.jsx)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:(0,t.jsxs)("div",{className:"flex items-center justify-between h-16",children:[(0,t.jsx)(o.default,{href:"/",className:"flex items-center",children:(0,t.jsx)("div",{className:"text-2xl font-bold text-primary-600",children:"\uD83C\uDF54 Food Ordering"})}),(0,t.jsxs)("nav",{className:"hidden md:flex items-center space-x-8",children:[(0,t.jsx)(o.default,{href:"/",className:"text-gray-700 hover:text-primary-600 transition-colors",children:"Home"}),(0,t.jsx)(o.default,{href:"/menu",className:"text-gray-700 hover:text-primary-600 transition-colors",children:"Menu"}),e&&(0,t.jsx)(o.default,{href:"/orders",className:"text-gray-700 hover:text-primary-600 transition-colors",children:"My Orders"}),s&&(0,t.jsx)(o.default,{href:"/admin",className:"text-gray-700 hover:text-primary-600 transition-colors",children:"Admin"})]}),(0,t.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,t.jsx)("button",{className:"p-2 text-gray-700 hover:text-primary-600 transition-colors",children:(0,t.jsx)(n.Z,{className:"w-5 h-5"})}),(0,t.jsxs)(o.default,{href:"/cart",className:"p-2 text-gray-700 hover:text-primary-600 transition-colors relative",children:[(0,t.jsx)(i.Z,{className:"w-5 h-5"}),x>0&&(0,t.jsx)("span",{className:"absolute -top-1 -right-1 bg-primary-600 text-white text-xs font-bold rounded-full w-5 h-5 flex items-center justify-center",children:x})]}),e?(0,t.jsx)(o.default,{href:"/profile",className:"p-2 text-gray-700 hover:text-primary-600 transition-colors",children:(0,t.jsx)(d.Z,{className:"w-5 h-5"})}):(0,t.jsx)(o.default,{href:"/sign-in",className:"bg-primary-600 text-white px-4 py-2 rounded-md hover:bg-primary-700 transition-colors",children:"Sign In"}),(0,t.jsx)("button",{className:"md:hidden p-2 text-gray-700 hover:text-primary-600 transition-colors",children:(0,t.jsx)(c.Z,{className:"w-5 h-5"})})]})]})})})}},1192:function(e,s,r){"use strict";r.d(s,{Providers:function(){return c},a:function(){return a.a},j:function(){return l.j}});var t=r(7437),a=r(3896),l=r(9099),n=r(2979),i=r(9827),d=r(2265);function c(e){let{children:s}=e,[r]=(0,d.useState)(()=>new n.S({defaultOptions:{queries:{staleTime:6e4,gcTime:6e5}}}));return(0,t.jsx)(i.aH,{client:r,children:(0,t.jsx)(a.Z,{children:(0,t.jsx)(l.Z,{children:s})})})}}},function(e){e.O(0,[215,33,648,419,99,971,117,744],function(){return e(e.s=2399)}),_N_E=e.O()}]);